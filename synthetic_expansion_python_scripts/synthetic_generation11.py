import json
import random
import datetime
import copy
from pathlib import Path

# Source file for JSON elements
SOURCE_FILE = "bronch_extractions_patched/bronch_notes_part_011.json"
OUTPUT_DIR = "Synthetic_expansions"

def generate_random_date(start_year, end_year):
    start = datetime.date(start_year, 1, 1)
    end = datetime.date(end_year, 12, 31)
    return start + (end - start) * random.random()

def get_variations():
    # Structure: Note_Index (0-4) -> Style_Index (1-9) -> Text
    variations = {
        0: { # RLL Nodule (Navigational + Radial EBUS + TBNA)
            1: "Indication: RLL nodule.\nAnesthesia: General (LMA, Propofol).\nProcedure:\n- Inspection: Normal anatomy.\n- Navigation: SuperDimension to RLL nodule.\n- Confirmation: Radial EBUS (concentric).\n- Sampling: Needle, brush, forceps used under fluoro.\n- EBL < 5cc.\nFindings: Successful biopsy RLL nodule. No complications.",
            2: "PROCEDURE: Electromagnetic Navigational Bronchoscopy with Multimodal Biopsy.\nINDICATIONS: Evaluation of right lower lobe pulmonary nodule.\nNARRATIVE: The patient was placed under general anesthesia with an LMA. A comprehensive airway inspection using a Q190 bronchoscope revealed no endobronchial anomalies. We proceeded with electromagnetic navigation (SuperDimension) utilizing a T190 therapeutic scope. The navigational catheter was successfully driven to the peripheral target in the right lower lobe. Radial endobronchial ultrasound confirmed lesion localization via a concentric echogenic signal. Transbronchial needle aspiration, brushing, and forceps biopsies were obtained under fluoroscopic guidance. Hemostasis was maintained throughout.",
            3: "Service: Bronchoscopy with Navigation and Biopsy (CPT 31629, 31627, 31654).\nTechnique: Electromagnetic navigation used to guide catheter to RLL target. Radial EBUS probe deployed to verify concentric location within lesion (31654). Transbronchial needle aspiration (31629) performed as primary sampling method, supplemented by brush and forceps. Fluoroscopic guidance utilized for all passes.",
            4: "Resident Procedure Note\nPatient: Unknown\nAttending: Unknown\nProcedure: Navigational Bronchoscopy RLL\nSteps:\n1. Time out. GA/LMA.\n2. Diagnostic inspection (Q190): Normal.\n3. Navigation (SuperDimension) to RLL lesion.\n4. Radial EBUS: Concentric view confirmed.\n5. Biopsies: TBNA, brush, forceps.\n6. Complications: None.\nPlan: Wait for path.",
            5: "Procedure for RLL nodule patient got propofol general anesthesia LMA placed. Looked with the Q190 everything normal no masses in the central airways. switched to the T190 for the superdimension nav stuff. got the catheter out to the RLL nodule radial ebus showed concentric view so we knew we were in it. Did needle brush and forceps biopsies fluoro used. minimal bleeding like 5cc maybe. patient tolerated well extubated sent to recovery.",
            6: "Indications right lower lobe nodule Medications Propofol infusion via anesthesia assistance Medications General Anesthesia Procedure risks benefits and alternatives were explained to the patient All questions were answered and informed consent was documented as per institutional protocol A history and physical were performed and updated in the pre-procedure assessment record Laboratory studies and radiographs were reviewed A time-out was performed prior to the intervention Following intravenous medications as per the record and topical anesthesia to the upper airway and tracheobronchial tree the Q190 video bronchoscope was introduced through the mouth via laryngeal mask airway and advanced to the tracheobronchial tree The laryngeal mask airway was in good position The vocal cords were normal The subglottic space was normal The trachea was of normal caliber The carina was sharp The tracheobronchial tree was examined to at least the first subsegmental level Bronchial mucosa and anatomy were normal there are no endobronchial lesions We then removed the diagnostic Q190 bronchoscopy and the super-dimension navigational catheter was inserted through the T190 therapeutic bronchoscope and advanced into the airway Using navigational map we attempted to advance the 90 degree edge catheter into the proximity of the lesion within the right lower lobe Confirmation of placement once at the point of interest with radial ultrasound showed a concentric view within the lesion Biopsies were then performed with a variety of instruments to include peripheral needle triple needle brush and forceps under fluoroscopic visualization After adequate samples were obtained the bronchoscope was removed and the procedure completed Complications No immediate complications Estimated Blood Loss Less than 5 cc Post Procedure Diagnosis Flexible bronchoscopy with successful navigational biopsy of right lower lobe nodule Recommendations Await final pathology",
            7: "[Indication]\nRight lower lobe nodule evaluation.\n[Anesthesia]\nGeneral anesthesia with LMA.\n[Description]\nDiagnostic bronchoscopy showed normal anatomy. Navigational bronchoscopy performed targeting RLL lesion. Radial EBUS confirmed concentric view. Lesion sampled via TBNA, brush, and forceps under fluoroscopy.\n[Plan]\nAwait pathology results.",
            8: "The patient presented for evaluation of a right lower lobe nodule. We induced general anesthesia using Propofol and placed an LMA. Initial inspection with the Q190 scope was unremarkable. We then utilized the SuperDimension navigation system through a therapeutic scope to reach the RLL target. Once at the site, radial ultrasound provided confirmation via a concentric image. We proceeded to obtain samples using a needle, brush, and forceps, utilizing fluoroscopy for visualization. The procedure concluded without complications and estimated blood loss was less than 5 cc.",
            9: "Indications: RLL nodule.\nMethod: Propofol anesthesia.\nAction: The Q190 was inserted and the airway surveyed; anatomy appeared normal. The diagnostic scope was withdrawn and the navigational system deployed via the T190. We navigated to the RLL target. Radial EBUS verified the position with a concentric return. We sampled the lesion using a peripheral needle, brush, and forceps under fluoro. The scope was extracted. No adverse events occurred."
        },
        1: { # RUL Nodule (Ultrathin + Radial EBUS + TBLB)
            1: "Indication: RUL nodule.\nAnesthesia: General (Propofol), LMA.\nFindings: Normal central airway.\nProcedure: Ultrathin (P190) scope to RUL. Radial EBUS: eccentric view. Samples: Forceps, brush. ROSE: Inadequate.\nComplications: None.\nPlan: Await final path.",
            2: "OPERATIVE REPORT: Diagnostic Bronchoscopy with Ultrathin Scope and Radial EBUS.\nINDICATION: Right upper lobe pulmonary nodule.\nPROCEDURE: Under general anesthesia, the airway was secured with an LMA. Initial inspection with a standard Q190 bronchoscope demonstrated normal laryngeal and tracheobronchial anatomy. The instrument was exchanged for a P190 ultrathin bronchoscope to navigate distal airways. The RUL nodule was localized; radial endobronchial ultrasound (REBUS) revealed an eccentric acoustic signal. Transbronchial biopsies and brushings were performed. Rapid On-Site Evaluation (ROSE) was indeterminate for malignancy and adequacy. The patient remained stable.",
            3: "Code Selection: 31628 (Transbronchial lung biopsy), +31654 (Radial EBUS guidance).\nNote: 31623 (Brushing) bundled. 31622 (Diagnostic) bundled.\nDetails: P190 ultrathin scope used to access RUL periphery. Radial EBUS probe deployed; eccentric view obtained (supports 31654). Biopsy forceps and brush used to sample lesion (supports 31628). ROSE analysis performed (result: inadequate).",
            4: "Resident Note\nProcedure: RUL Nodule Biopsy\nSteps:\n1. Propofol induction, LMA placed.\n2. Q190 inspection: Normal.\n3. P190 ultrathin scope to RUL.\n4. REBUS check: Eccentric view.\n5. Biopsies taken (forceps, brush).\n6. ROSE: Nondiagnostic.\nNo complications.",
            5: "We did a bronch for a RUL nodule patient got propofol general anesthesia LMA used. First look with the regular scope was normal no lesions seen. Switched to the tiny P190 scope and went out to the RUL found the spot with radial EBUS but it was an eccentric view not concentric. Did biopsies with forceps and brush. ROSE guy said he couldn't see cancer or if it was adequate. No bleeding though. All done.",
            6: "Indications Right upper lobe nodule Medications Propofol infusion via anesthesia assistance Procedure risks benefits and alternatives were explained to the patient All questions were answered and informed consent was documented as per institutional protocol A history and physical were performed and updated in the preprocedure assessment record Laboratory studies and radiographs were reviewed A time-out was performed prior to the intervention Following intravenous medications as per the record and topical anesthesia to the upper airway and tracheobronchial tree the Q190 video bronchoscope was introduced through the mouth via laryngeal mask airway and advanced to the tracheobronchial tree The laryngeal mask airway is in good position The vocal cords appeared normal The subglottic space was normal The trachea is of normal caliber The carina is sharp The tracheobronchial tree was examined to at least the first subsegmental level Bronchial mucosa and anatomy were normal there are no endobronchial lesions and no secretions The bronchoscope was then removed and the P190 ultrathin video bronchoscope was inserted into the airway and based on anatomical knowledge advanced into the right upper lobe to the area of known nodule and an eccentric view of the lesion was identified with the radial EBUS Biopsies were then performed with a variety of instruments to include peripheral needle forceps and brush After adequate samples were obtained the bronchoscope was removed ROSE did not identify malignancy and unable to clearly identify that adequate sampling was performed Complications No immediate complications Estimated Blood Loss Less than 5 cc Post Procedure Diagnosis Technically successful peripheral radial probe guided eccentric localization Will await final pathology results",
            7: "[Indication]\nRight upper lobe nodule.\n[Anesthesia]\nGeneral, LMA.\n[Description]\nNormal central airway exam. Ultrathin P190 scope advanced to RUL. Radial EBUS identified lesion (eccentric view). Biopsy forceps and brush used for sampling. ROSE result inadequate.\n[Plan]\nFollow up final pathology.",
            8: "The patient underwent bronchoscopy for a right upper lobe nodule under general anesthesia. We first inspected the airway with a standard bronchoscope and found normal anatomy. We then switched to the P190 ultrathin scope to reach the periphery. Using radial EBUS, we located the lesion, noting an eccentric view. We proceeded to sample the area using forceps and a brush. Unfortunately, the ROSE assessment was nondiagnostic and could not confirm adequacy. There were no complications.",
            9: "Indication: RUL nodule.\nMethod: Propofol sedation.\nAction: The airway was surveyed with the Q190; all normal. The P190 ultrathin scope was inserted and navigated to the RUL target. Radial EBUS located the lesion eccentrically. We sampled the site using forceps and brush. The scope was withdrawn. ROSE failed to confirm adequacy."
        },
        2: { # Staging Bilateral CA (EBUS 4L, 7, 4R)
            1: "Indication: Staging bilateral lung CA.\nAnesthesia: GA, LMA.\nProcedure:\n- Diagnostic bronch: Normal.\n- EBUS (UC180F): Sampled 4L (1 pass, difficult), 7 (benign lymphs), 4R.\n- ROSE: Non-diagnostic for 4L/4R.\nComplications: None.\nPlan: PACU, Pathology.",
            2: "PROCEDURE: Endobronchial Ultrasound-Guided Transbronchial Needle Aspiration (EBUS-TBNA) for Mediastinal Staging.\nCLINICAL CONTEXT: Bilateral lung malignancy; ruling out metastasis vs synchronous primary.\nFINDINGS: Conventional bronchoscopy revealed normal endobronchial anatomy. The EBUS scope was introduced. Systematic nodal survey identified targets at stations 4L, 7, and 4R meeting size criteria (>5mm). TBNA was performed using a 22G needle. Station 4L was technically challenging; only one pass was feasible. Station 7 yielded benign lymphocytes on ROSE. Station 4R was also sampled. Cytology pending.",
            3: "Code: 31653 (EBUS sampling 3+ stations).\nStations sampled: 4L, 7, 4R.\nTools: 22G Olympus EBUS-TBNA needle.\nNote: 4L difficult access (1 pass). ROSE performed (99152/3 N/A due to GA).\nDiagnostic bronchoscopy (31622) bundled.",
            4: "Resident Note\nProcedure: EBUS Staging\nStations: 4L, 7, 4R\nSteps:\n1. GA/LMA established.\n2. White light exam: Normal.\n3. EBUS scope inserted.\n4. Biopsied 4L (hard to reach), 7, and 4R.\n5. ROSE: 7 had lymphs, others non-diagnostic.\nNo bleeding.",
            5: "Staging bronch for lung cancer general anesthesia used. Looked with regular scope first everything normal. Switched to EBUS scope. Sampled nodes 4L 7 and 4R. 4L was really hard to get to because of the angle only got one pass. ROSE said benign lymphs in 7 but nothing in the others. Sent everything for cytology. minimal blood loss patient to pacu.",
            6: "Indications staging of bilateral lung cancer metastatic vs synchronous primary Medications General Anesthesia Procedure risks benefits and alternatives were explained to the patient All questions were answered and informed consent was documented as per institutional protocol A history and physical were performed and updated in the pre-procedure assessment record Laboratory studies and radiographs were reviewed A time-out was performed prior to the intervention Following intravenous medications as per the record and topical anesthesia to the upper airway and tracheobronchial tree the Q190 video bronchoscope was introduced through the mouth via laryngeal mask airway and advanced to the tracheobronchial tree The laryngeal mask airway was in good position The vocal cords appeared normal The subglottic space was normal The trachea was of normal caliber The carina was sharp The tracheobronchial tree was examined to at least the first sub-segmental level Bronchial mucosa and anatomy were normal there are no endobronchial lesions and no secretions The video bronchoscope was then removed and the UC180F convex probe EBUS bronchoscope was introduced through the mouth via laryngeal mask airway and advanced to the tracheobronchial tree A systematic hilar and mediastinal lymph node survey was carried out Sampling criteria 5mm short axis diameter were met in station 4LR 7 and 4R lymph nodes Sampling by transbronchial needle aspiration was performed beginning with the 4L Lymph node followed by 7 and 4R lymph nodes using an Olympus EBUSTBNA 22 gauge needle The 4L lymph node was extremely difficult to access due to angle of left mainstem and after one biopsy no further attempts performed Further details regarding nodal size and number of samples are included in the EBUS procedural sheet which is available in AHLTA ROSE showed non-diagnostic tissue in the 4L and 4R lymph nodes and benign lymphocytes in the station 7 lymph node All samples were sent for routine cytology The Q190 video bronchoscope was then re-inserted and after suctioning blood and secretions there was no evidence of active bleeding and the bronchoscope was subsequently removed Complications No immediate complications Estimated Blood Loss 5 cc Post Procedure Recommendations Transfer to PACU and home per protocol Will await final pathology results",
            7: "[Indication]\nStaging bilateral lung cancer.\n[Anesthesia]\nGeneral.\n[Description]\nNormal airway exam. EBUS-TBNA performed on stations 4L, 7, and 4R. 4L difficult access. ROSE confirmed lymphocytes in station 7.\n[Plan]\nHome per protocol.",
            8: "We performed this procedure to stage bilateral lung cancer. Under general anesthesia, we first inspected the airways and found them normal. We then introduced the EBUS scope and identified enlarged nodes at stations 4L, 7, and 4R. We sampled all three stations using a 22 gauge needle. Accessing the 4L node was technically difficult, limiting us to one pass. Preliminary ROSE analysis showed benign lymphocytes in station 7 but was non-diagnostic for 4L and 4R. We concluded the procedure without complications.",
            9: "Indication: Cancer staging.\nMethod: General anesthesia.\nAction: The airway was surveyed; no abnormalities found. The EBUS scope was deployed. We interrogated and aspirated nodes at 4L, 7, and 4R. 4L proved challenging. ROSE verified lymphocytes at station 7. All specimens were dispatched for cytology. The scope was removed."
        },
        3: { # BI Tumor (Rigid + Cryo + Stent)
            1: "Indication: Bronchus Intermedius tumor obstruction.\nAnesthesia: GA. Jet vent failed -> Conventional vent via rigid.\nProcedure:\n- Rigid bronch (12mm).\n- Cryo-debridement of tumor in BI.\n- Aspiration of purulent fluid (culture).\n- Stent: Aero 20x10mm placed over wire.\nResult: BI patent. RML/RLL aerated.\nPlan: ICU. Wean vent.",
            2: "PROCEDURE: Rigid Bronchoscopy with Tumor Debulking and Stenting.\nINDICATION: Malignant obstruction of the Bronchus Intermedius (BI) with post-obstructive pneumonia.\nNARRATIVE: General anesthesia was induced. A 12mm rigid bronchoscope was inserted. Jet ventilation proved inadequate due to hypoxia, necessitating conversion to a closed system with conventional ventilation. Inspection revealed a fleshy, obstructive tumor in the proximal BI with distal purulence. Thermal ablation was contraindicated due to high FiO2. We performed mechanical coring and cryo-extraction to recanalize the airway. Copious purulent secretions were evacuated. An Aero 20x10mm covered metallic stent was deployed over a guidewire under fluoroscopic control. Post-deployment inspection confirmed patency of the RUL, RML, and RLL orifices.",
            3: "Billing Codes:\n- 31636: Stent placement, initial bronchus (BI).\n- 31640 (Bundled): Tumor excision performed to prep airway for stent.\n- 31645 (Bundled): Aspiration of secretions.\nNarrative: Rigid bronchoscopy used for access. Mechanical and cryo-debulking performed to facilitate stent. Aero 20x10mm stent placed. Fluoroscopy used.",
            4: "Resident Note\nProcedure: Rigid Bronch/Stent\nPatient: Unknown\nSteps:\n1. GA. Rigid scope inserted.\n2. Hypoxia -> Switched to conventional vent.\n3. Found BI tumor blocking RML/RLL.\n4. Debulked with rigid tip and cryo.\n5. Sucked out pus (culture).\n6. Placed Aero stent 20x10mm.\n7. Re-intubated.\nPlan: ICU.",
            5: "Patient has tumor blocking the bronchus intermedius. We put him under general. Tried jet vent but sats dropped so we switched to regular vent through the rigid scope. Saw the tumor blocking everything right upper lobe was open though. Used cryo to clean it up and apple cored it with the rigid scope. Sucked out a ton of nasty pus from behind the blockage. Put in an Aero stent 20 by 10. Looks good now airway open. Back to ICU.",
            6: "INDICATIONS Tumor obstruction of bronchus intermedius Consent was obtained from the patient prior to procedure after explanation in lay terms the indications details of procedure and potential risks and alternatives The patient’s family acknowledged and gave consent Sedation General Anesthesia DESCRIPTION OF PROCEDURE The procedure was performed in the bronchoscopy suite Following anesthetic induction the endotracheal tube was removed and a 12 mm ventilating rigid bronchoscope was inserted and easily passed into the airway and advanced to the distal trachea and then attached to the jet ventilator Due to hypoxia and difficulty obtaining sufficient chest wall expansion the decision was made to convert to conventional ventilation The rigid bronchsocpe was attached to the conventional ventilator adapter the mouth was packed and the side ports were closed to allow closed system ventilation The flexible bronchoscope was then advanced through the rigid bronchoscope into the airway On initial bronchoscopic inspection the trachea and left lung appeared normal without evidence of endobronchial disease Within the proximal bronchus intermedius a completely obstructive tumor with overlying blood clot was seen The right upper lobe however was widely patent Using cryotherapy probe we removed the overlying blood clot and were able to better visualize the obstructive tumor which originated at the medial aspect of the BI with a wide based stock A small opening was seen at the lateral aspect but was too small to visualize and open airways distally Due to high oxygen requirements and persistent hypoxemia we were unable to utilize thermal therapies for debulking We thus advanced to the rigid bronchoscope into the proximal bronchus intermedius and using the beveled tip attempted to apple core the proximal edge of the lesion which allowed for us to then cryo-debulk the lesion with a lower risk of developing an area repair Two large pieces of tumor were successfully removed with carotid debulking and we were then able to advance the bronchoscope passed the obstruction into the distal bronchus intermedius where we could visualize the right middle lobe and the orifice of the superior segment and basilar segments of the right lower lobe Extensive purulent material consistent with postobstructive pneumonia was seen and suctioned into a trap to be sent for culture At this point we measured the length of the obstruction and inserted a Jagwire through the flexible bronchoscope past the lesion and using fluoroscopy marked the proximal and distal edges of the obstructed bronchus intermedius with radiopaque markers paper clips taped to the patient’s chest wall The flexible bronchoscope was removed and an Aero 20mm x 10mm fully covered self-expandable metallic stent loading device was advanced over the guidewire and positioned for an appointment based on the external markers under fluoroscopic observation The stent was deployed without difficulty and the flexible bronchoscope was then re-inserted through the rigid bronchoscope and the stent was observed to be well-seated in the bronchus intermedius allowing aeration of the right upper lobe bronchus intermedius and the distal airways to include the right middle and right lower lobe including the superior segment Once we were satisfied that no further intervention was required the rigid bronchoscope was removed and the patient was re-intubated fiber-optically without difficulty Recommendations Transfer patient back to the ICU Attempt extubation when deemed appropriate by ICU team with goal of patient transferring to home for end-of-life/hospice care",
            7: "[Indication]\nTumor obstruction of Bronchus Intermedius.\n[Anesthesia]\nGeneral. Rigid bronchoscopy required conversion to conventional ventilation due to hypoxia.\n[Description]\nObstructive tumor in BI. Debulked using rigid coring and cryotherapy. Purulent secretions drained. Aero 20x10mm stent deployed.\n[Plan]\nICU admission. Palliative care.",
            8: "The patient presented with tumor obstruction of the bronchus intermedius. We initiated the procedure under general anesthesia using a 12mm rigid bronchoscope. We initially attempted jet ventilation but had to convert to conventional ventilation due to hypoxia. Upon inspection, we found the BI completely obstructed by tumor. We debulked the lesion using the bevel of the rigid scope and cryotherapy. This revealed significant purulent secretions distally, which we aspirated. To maintain patency, we placed an Aero 20mm x 10mm stent. The airway was visually confirmed to be patent post-procedure.",
            9: "Indication: BI obstruction.\nMethod: Rigid bronchoscopy, General anesthesia.\nAction: The rigid scope was inserted. Ventilation was adjusted due to hypoxia. We identified the tumor and extracted clot and tissue via cryo and coring. Purulence was aspirated. We deployed an Aero stent (20x10mm) over a guidewire. Patency was restored."
        },
        4: { # LMS Extrinsic Compression (Stent + Balloon + Aspiration)
            1: "Indication: LMS extrinsic compression.\nAnesthesia: GA. Rigid attempted -> leak. Switched to ETT 8.5.\nFindings: L vocal cord paralysis. LMS 95% obstructed (extrinsic).\nAction: Dilated. Aero stent 12x40mm placed. Balloon dilated (10-12mm). Copious purulent secretions suctioned (31645).\nResult: LMS 80% patent.\nPlan: Saline nebs. Humidified O2.",
            2: "PROCEDURE: Flexible Bronchoscopy with Stent Placement and Therapeutic Aspiration.\nINDICATION: Extrinsic compression of Left Mainstem Bronchus.\nNARRATIVE: The patient presented with left vocal cord paralysis and severe LMS obstruction. Rigid bronchoscopy was attempted but aborted due to significant air leak; the procedure was completed via an 8.5 ETT. The LMS was 90-95% obstructed by extrinsic compression. Thick purulent secretions were aspirated throughout the bronchial tree. An Aero 12x40mm stent was deployed over a guidewire. Post-deployment balloon dilation was performed using a CRE balloon to expand the stent against the extrinsic compression. Final airway caliber was approximately 80% of normal.",
            3: "Billing Codes:\n- 31636: Stent placement LMS.\n- 31645-59: Therapeutic aspiration (separate distinct service for diffuse purulence).\n- 31630 (Bundled): Balloon dilation of stent.\nDetails: Rigid aborted. Flexible used. Aero 12x40mm stent placed. Balloon dilation to expand stent. Extensive suctioning of purulent secretions performed.",
            4: "Resident Note\nProcedure: Stent LMS\nSteps:\n1. Inducted GA.\n2. L VC paralysis noted.\n3. Rigid bronch attempted -> leak -> Aborted.\n4. ETT placed.\n5. Saw 95% LMS obstruction.\n6. Suctioned lots of pus.\n7. Placed Aero 12x40 stent.\n8. Balloon dilated stent.\nPlan: Saline nebs.",
            5: "Tried to do a rigid bronch for left mainstem compression but there was a huge leak so we had to intubate with an 8.5 tube instead. The left mainstem was squished about 95 percent shut. Also vocal cord paralysis on the left. Suctioned out a bunch of thick pus from everywhere. Put in an Aero stent 12 by 40. Had to balloon it open cause the compression was tight. Looks about 80 percent open now. Start saline nebs.",
            6: "POSTOPERATIVE DIAGNOSIS 1 Resolved mainstem obstruction sp areo stent PROCEDURE PERFORMED Rigid bronchoscopy with Aero tracheobronchial stent placement in the left mainstem INDICATIONS extrinsic compression of left mainstem bronchus Consent was obtained from the patient prior to procedure after explanation in lay terms the indications details of procedure and potential risks and alternatives The patient’s family acknowledged and gave consent Sedation General Anesthesia DESCRIPTION OF PROCEDURE The procedure was performed in the main operating room After administration of sedatives the flexible bronchoscope was inserted through the LMA and into the pharynx The left vocal cord was noted to be fixed consistent with vocal cord paralysis Muscle relaxants were then given and we then advanced the bronchoscope into the subglottic space Airway inspection was performed and there were thick purulent secretions throughout the airways which were suctioned In the mid to distal trachea there was approximately 30-40% obstruction from posterior extrinsic compression The right mainstem was approximately 15% obstructed at the proximal orifice and opened up to be widely patent distally The right-sided airways were free of endobronchial disease in the mucosa was normal On the left there was significant airway obstruction beginning at the orifice of the left mainstem with friable erythematous mucosa causing approximately 40% obstruction however in the mid left mainstem there is significant protrusion of extrinsic mass with likely some degree of submucosal infiltration resulting in about 90-95% airway obstruction The therapeutic bronchoscope could not pass the lesion We then attempted to pass lesion with the diagnostic Q 190 bronchoscope and were also unsuccessful We then again attempted to pass lesion with the ultrasound P190 bronchoscope which was successfully able to bypass lesion Approximately 5 mm proximal to the LC2 carina the airways open to near normal luminal diameter There were thick postobstructive secretions at all left-sided airways which were suctioned At this point the flexible bronchoscope was removed along with the LMA and a 10mm ventilating rigid bronchoscope was subsequently inserted into the distal trachea and connected to ventilator There is a significant week which impaired ability to ventilate and multiple attempts at packing the mouth were unsuccessful The 10 mm rigid bronchoscope was then removed and a 13 mm non-ventilating tracheoscope was introduced in the airway in a similar fashion with the hope that this would eliminate reduce the ventilator leak however similar issues arose and we subsequently decided to remove the rigid bronchoscope and perform the procedure through a 8.5 ET tube which was placed by anesthesia There was some hypoxia for a few minutes mostly in the mid 80s but for a short period time in the upper 70s which was likely related to the recruitment from the time period of inadequate ventilation which eventually resolved allowing us to continue with the procedure At this point we measured the length of the obstruction and inserted a Jagwire through the flexible bronchoscope past the lesion and using fluoroscopy marked the proximal and distal edges of the obstructed left mainstem with radiopaque markers paper clips taped to the patient’s chest wall The flexible bronchoscope was removed and an Aero 12x40 mm stent was advanced over the guidewire and positioned based on the external markers under fluoroscopic observation The stent was deployed however slightly too distally and was retracted into proper position with forceps Balloon dilatation was then performed of the stent which only partially open due to significant external compression using a 10 11 12 CRE balloon which expanded the stent with only mild deformity with a subsequent diameter of the left mainstem approximately 80% of normal Once we were satisfied that no further intervention was required the bronchoscope was removed and the case was turned over to anesthesia to recover the patient Recommendations Transfer back to ward Post-procedure x-ray Start 3% saline nebs 3cc combined with 2cc albuterol 3 times daily for stent maintenance Ensure supplemental oxygen is humidified Please arrange for patient to have nebulizer at home for continued hypertonic saline nebs post-discharge",
            7: "[Indication]\nExtrinsic compression LMS.\n[Anesthesia]\nGeneral. Rigid failed due to leak; converted to ETT.\n[Description]\nLeft vocal cord paralysis. LMS 95% obstructed. Thick purulence suctioned (therapeutic aspiration). Aero 12x40mm stent deployed. Balloon dilation required to expand stent against compression.\n[Plan]\nHypertonic saline nebs.",
            8: "The patient was brought in for stenting of a left mainstem extrinsic compression. We observed left vocal cord paralysis. Initial attempts at rigid bronchoscopy failed due to a ventilation leak, so we proceeded with an 8.5 ET tube. The LMS was 95% obstructed. We suctioned thick purulent secretions from the distal airways. We then placed an Aero 12x40 mm stent over a guidewire. Due to the compression, we had to balloon dilate the stent to achieve 80% patency.",
            9: "Indication: LMS compression.\nMethod: General anesthesia, ETT (Rigid failed).\nAction: We observed paralysis of the left cord. We aspirated thick secretions. We deployed an Aero stent (12x40mm) into the LMS. We expanded the stent with a balloon to counteract the compression. Patency was improved."
        }
    }
    return variations

def get_base_data_mocks():
    return [
        {"idx": 0, "orig_name": "Unknown", "orig_age": 65, "names": ["John Doe", "Robert Smith", "Michael Johnson", "William Brown", "David Jones", "Richard Miller", "Joseph Davis", "Thomas Garcia", "Charles Rodriguez"]},
        {"idx": 1, "orig_name": "Unknown", "orig_age": 60, "names": ["Mary Wilson", "Patricia Martinez", "Linda Anderson", "Barbara Taylor", "Elizabeth Thomas", "Jennifer Hernandez", "Maria Moore", "Susan Martin", "Margaret Jackson"]},
        {"idx": 2, "orig_name": "Unknown", "orig_age": 70, "names": ["James White", "John Lopez", "Robert Lee", "Michael Gonzalez", "William Harris", "David Clark", "Richard Lewis", "Joseph Robinson", "Thomas Walker"]},
        {"idx": 3, "orig_name": "Unknown", "orig_age": 55, "names": ["Sarah Perez", "Karen Hall", "Nancy Young", "Lisa Allen", "Betty Sanchez", "Dorothy Wright", "Sandra King", "Ashley Scott", "Kimberly Green"]},
        {"idx": 4, "orig_name": "Unknown", "orig_age": 75, "names": ["Daniel Baker", "Paul Adams", "Mark Nelson", "Donald Hill", "George Ramirez", "Kenneth Campbell", "Steven Mitchell", "Edward Roberts", "Brian Carter"]}
    ]

def main():
    # Load original data from source file
    try:
        with open(SOURCE_FILE, 'r', encoding='utf-8') as f:
            source_data = json.load(f)
    except FileNotFoundError:
        print(f"Error: Source file not found: {SOURCE_FILE}")
        return
    except json.JSONDecodeError as e:
        print(f"Error: Invalid JSON in source file: {e}")
        return
    
    if not isinstance(source_data, list):
        print(f"Error: Source file must contain a JSON array, got {type(source_data)}")
        return
    
    print(f"Loaded {len(source_data)} notes from {SOURCE_FILE}")
    
    variations_text = get_variations()
    base_data = get_base_data_mocks()
    
    # Ensure output directory exists
    output_dir = Path(OUTPUT_DIR)
    output_dir.mkdir(parents=True, exist_ok=True)
    
    generated_notes = []
    
    # Iterate through each original note in source data
    for idx, original_note in enumerate(source_data):
        if idx >= len(base_data):
            break
            
        record = base_data[idx]
        orig_age = record['orig_age']
        
        # Iterate through the 9 styles
        for style_num in range(1, 10):
            
            # Deep copy the original note structure
            note_entry = copy.deepcopy(original_note)
            
            # Determine new random age (+/- 3 years)
            new_age = orig_age + random.randint(-3, 3)
            
            # Determine new random date (within 2025)
            rand_date_obj = generate_random_date(2025, 2025)
            rand_date_str = rand_date_obj.strftime("%Y-%m-%d")
            
            # Get the specific name assigned
            new_name = record['names'][style_num - 1]
            
            # Update note_text with the variation
            if idx in variations_text and style_num in variations_text[idx]:
                note_entry["note_text"] = variations_text[idx][style_num]
            
            # Update registry_entry fields if they exist
            if "registry_entry" in note_entry:
                if note_entry["registry_entry"].get("patient_mrn") == "UNKNOWN":
                     note_entry["registry_entry"]["patient_mrn"] = f"IP20260{idx}_syn_{style_num}"
                
                # Some entries have patient_demographics
                if "patient_demographics" in note_entry["registry_entry"] and note_entry["registry_entry"]["patient_demographics"]:
                     note_entry["registry_entry"]["patient_demographics"]["age_years"] = new_age
                
                note_entry["registry_entry"]["procedure_date"] = rand_date_str

            
            # Add metadata about the synthetic generation
            note_entry["synthetic_metadata"] = {
                "source_file": SOURCE_FILE,
                "original_index": idx,
                "style_type": style_num,
                "generated_name": new_name,
                "generation_date": datetime.datetime.now().isoformat()
            }
            
            generated_notes.append(note_entry)

    # Output to JSON in Synthetic_expansions folder
    output_filename = output_dir / "synthetic_bronch_notes_part_011.json"
    with open(output_filename, 'w', encoding='utf-8') as f:
        json.dump(generated_notes, f, indent=2, ensure_ascii=False)
    
    print(f"Successfully generated {len(generated_notes)} synthetic notes in {output_filename}")

if __name__ == "__main__":
    main()